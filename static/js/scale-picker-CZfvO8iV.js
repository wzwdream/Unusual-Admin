class x{constructor(n){this.config={el:null,start:0,end:100,width:200,height:120,scale:1,unit:10,capacity:1,currentValue:0,fontSize:14,fontColor:"#333",background:"",midLineColor:"",openUnitChange:!1},this.canvasDom=null,this.current_def=0,this.dpr=window.devicePixelRatio||1.2,this.ctx=null,this.callBack=i=>{},this.moveDraw=()=>{this.ctx.clearRect(0,0,this.config.width,this.config.height),this.createScale(),this.createMidCursor(),typeof this.callBack=="function"&&this.callBack(Math.round(this.current_def))},this.slowActionFn=function(i,h,s,t){return s*((i=i/t-1)*i*i+1)+h},this.config=n;try{if(n.onChange&&typeof n.onChange=="function")this.callBack=n.onChange;else throw new Error("onChange is not a function")}catch(i){console.log(i)}this.init()}init(){this.createCanvas(),this.createScale(),this.createMidCursor(),this.addEvent()}createCanvas(){var n,i,h,s,t,a;this.canvasDom=document.createElement("canvas");const o=(i=(n=this.config)==null?void 0:n.el)==null?void 0:i.getBoundingClientRect();this.config.width=Math.floor(Number(o==null?void 0:o.width)),this.config.height=Math.floor(Number(this.config.height)),this.canvasDom.style.width=`${this.config.width}px`,this.canvasDom.style.height=`${this.config.height}px`,this.canvasDom.width=this.dpr*((h=this.config)==null?void 0:h.width),this.canvasDom.height=this.dpr*((s=this.config)==null?void 0:s.height),(t=this.config.el)==null||t.appendChild(this.canvasDom),this.ctx=this.canvasDom.getContext("2d"),(a=this.ctx)==null||a.scale(this.dpr,this.dpr),this.current_def=Math.floor(((this.config.end-this.config.start)/2+this.config.start)/this.config.capacity)*this.config.capacity}createScale(){var n,i,h;const s=document.createElement("canvas"),t=s.getContext("2d");s.width=this.config.width*this.dpr,s.height=this.config.height*this.dpr,t.scale(this.dpr,this.dpr);const a=this.current_def-this.config.width/2*(this.config.capacity/this.config.unit);let o=0,c=0;const f=Math.ceil((this.config.width+1)/this.config.unit),g=Math.ceil((this.config.end-this.config.start+1)/this.config.capacity);t.fillStyle=((n=this.config)==null?void 0:n.background)??"transparent",t.fillRect(0,0,this.config.width,this.config.height),t.closePath(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.config.width,0),t.strokeStyle="#333",t.lineWidth=1,t.stroke(),t.closePath();const d=(Math.ceil(a/this.config.capacity)*this.config.capacity-a)*(this.config.unit/this.config.capacity);for(let e=0;e<f;e++){if(c=(Math.ceil(a/this.config.capacity)+e)*this.config.capacity,c<this.config.start)continue;if(c>this.config.end)break;t.beginPath(),t.strokeStyle=this.config.scaleLineColor||"#1675DE",t.font=String(this.config.fontSize??14),t.fillStyle=this.config.fontColor??"#333",t.textAlign="center",t.shadowBlur=0,o=d+e*this.config.unit;const r=()=>{Math.round(this.current_def)===c&&(t.fillStyle="#1675DE",t.font="18px Helvetica, Tahoma, Arial",t.fillText(String(c),o,75))};c%(this.config.capacity*10)===0||c===this.config.start?(t.moveTo(o,this.config.height/2),t.strokeStyle=((i=this.config)==null?void 0:i.scaleLineColor)||"#4AC979",t.shadowColor="#9e9e9e",t.shadowBlur=1,t.font="14px Helvetica, Tahoma, Arial",Math.round(this.current_def)===c?r():t.fillText(String(c),o,75)):c%(this.config.capacity*5)===0?(t.moveTo(o,this.config.height/2),t.strokeStyle=((h=this.config)==null?void 0:h.scaleLineColor)||"#FF131B",g<=10&&(t.font="14px Helvetica, Tahoma, Arial",Math.round(this.current_def)===c?r():t.fillText(String(c),o,75))):t.moveTo(o,this.config.height/4),t.lineTo(o,0),t.stroke(),t.closePath()}this.ctx.drawImage(s,0,0,this.config.width*this.dpr,this.config.height*this.dpr,0,0,this.config.width,this.config.height)}createMidCursor(){var n;const i=Math.floor(this.config.width/2);this.ctx.beginPath(),this.ctx.fillStyle=((n=this.config)==null?void 0:n.midLineColor)||"#e5c17c",this.ctx.stroke(),this.ctx.moveTo(i,10),this.ctx.lineTo(i-5,2),this.ctx.lineTo(i-5,0),this.ctx.lineTo(i+5,0),this.ctx.lineTo(i+5,2),this.ctx.fill(),this.ctx.closePath()}addEvent(){let n=0,i=!1,h=0,s=0,t=0;const a=e=>{e.stopPropagation(),e.preventDefault(),i=!0,e.touches?n=e.touches[0].pageX:n=e.pageX,t=n,s=e.timeStamp||Date.now()},o=e=>{e.stopPropagation(),e.preventDefault();const r=e.touches?e.touches[0].pageX:e.pageX;if((this.current_def<this.config.start||this.current_def>this.config.end)&&(i=!1),i){const u=r-n;this.current_def=this.current_def-u*(this.config.capacity/this.config.unit),window.requestAnimationFrame(this.moveDraw),n=r;const l=e.timeStamp||Date.now();l-s>300&&(s=l,t=n)}},c=e=>{const r=e.changedTouches?e.changedTouches[0].pageX:e.pageX,u=e.timeStamp||Date.now(),l=-(r-t)/(u-s),m=()=>{this.current_def=this.slowActionFn(p,h,this.config.capacity*l*50,_),this.current_def<this.config.start?this.current_def=this.config.start:this.current_def>this.config.end&&(this.current_def=this.config.end),this.config.openUnitChange&&(this.current_def=Math.round(this.current_def/this.config.capacity)*this.config.capacity),this.moveDraw(),p++,p<=_&&window.requestAnimationFrame(m)};i=!1;let p=0;const _=15;Math.abs(l)>=.3?(h=this.current_def,m()):(this.current_def<this.config.start?this.current_def=this.config.start:this.current_def>this.config.end&&(this.current_def=this.config.end),this.config.openUnitChange&&(this.current_def=Math.round(this.current_def/this.config.capacity)*this.config.capacity),this.moveDraw())},f="ontouchstart"in window,g=f?"touchstart":"mousedown",v=f?"touchmove":"mousemove",d=f?"touchend":"mouseup";this.canvasDom.addEventListener(g,a),this.canvasDom.addEventListener(v,o),this.canvasDom.addEventListener(d,c)}}export{x as S};
