import{h as e,i as a,o as t,j as l,bo as o,w as i,t as d,bm as n,k as s,C as u,l as r,Q as v,af as c,F as p,R as h,E as f,K as g,Y as w,$ as m,aT as y,M as b,bp as k}from"./.pnpm-13a7460c.js";import{h as C,m as z,o as R}from"./index-69a904c4.js";const S={flex:"","justify-end":""},x=e({name:"BaseModel"}),$=e({...x,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(e,{emit:f}){const g=e,w=f,m=a({get:()=>g.visible,set(e){w("update:visible",e)}});return(e,a)=>{const f=p,g=h;return t(),l(g,{show:r(m),"onUpdate:show":a[2]||(a[2]=e=>v(m)?m.value=e:null),style:c({width:e.width}),preset:"card",title:e.title,size:"huge",bordered:!1},o({default:i((()=>[n(e.$slots,"default")])),_:2},[e.showFooter?{name:"footer",fn:i((()=>[d("footer",S,[n(e.$slots,"footer",{},(()=>[s(f,{onClick:a[0]||(a[0]=e=>m.value=!1)},{default:i((()=>[u("取消")])),_:1}),s(f,{loading:e.loading,"ml-20":"",type:"primary",onClick:a[1]||(a[1]=e=>w("save"))},{default:i((()=>[u("保存")])),_:1},8,["loading"])]))])])),key:"0"}:void 0]),1032,["show","style","title"])}}}),B=e({name:"TableAction"}),D=e({...B,props:{view:{type:Boolean,default:!0},edit:{type:Boolean,default:!0},del:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["handleView","handleEdit","handleDelete"],setup(e,{emit:a}){const o=e,d=a;return(e,a)=>{const n=p,s=w;return t(),l(s,{justify:"center"},{default:i((()=>[o.view?(t(),l(n,{key:0,type:"info",text:"",size:"small",onClick:a[0]||(a[0]=e=>d("handleView"))},{default:i((()=>[u(f(e.$t("view")),1)])),_:1})):g("",!0),o.edit?(t(),l(n,{key:1,disabled:e.disabled,type:"warning",text:"",size:"small",onClick:a[1]||(a[1]=e=>d("handleEdit"))},{default:i((()=>[u(f(e.$t("edit")),1)])),_:1},8,["disabled"])):g("",!0),o.del?(t(),l(n,{key:2,disabled:e.disabled,type:"error",text:"",size:"small",onClick:a[2]||(a[2]=e=>d("handleDelete"))},{default:i((()=>[u(f(e.$t("delete")),1)])),_:1},8,["disabled"])):g("",!0)])),_:1})}}}),_=({name:e,url:t,key:l="id",isPagination:o=!0,isInitQuery:i=!0,initForm:d={},initQuery:n={},doCreate:s,doDelete:u,doUpdate:r,beforeRefresh:v,afterRefresh:c,beforeSave:p,afterSave:h})=>{const{t:f}=m(),g=a((()=>({view:f("view"),edit:f("edit"),add:f("add")}))),w=b(!1),S=b(""),x=b(!1),$=b(null),B=b({...d}),D=b({...n}),_=a((()=>g.value[S.value]+" "+(e||""))),F=a((()=>"view"!==S.value)),{changeCheckRow:Q,checkedRowKeys:j,checkedRow:P}=(()=>{const e=b([]),a=b([]);return{checkedRowKeys:e,changeCheckRow:(t,l)=>{e.value=t,a.value=k(l)},checkedRow:a}})(),T=a((()=>{var e;return null==(e=P.value)?void 0:e.map((e=>e[l]))})),E=b(!1),K=b(),U=async()=>{E.value=!0;try{let e={...D.value};o&&(e={page:(null==V?void 0:V.page)||0,pageSize:(null==V?void 0:V.pageSize)||10,...D.value});const a=v&&v(e);if("boolean"==typeof a&&!a)return;a&&"boolean"!=typeof a&&(e=a);const{data:l,total:i}=await((e,a)=>C.get(e,a))(t,e),d=c&&c([...l]);K.value=d?d||[]:l||[],o&&(V.itemCount=i||0),E.value=!1}catch(e){E.value=!1}},{pagination:V}=(e=>{const{t:t}=m(),l=a((()=>({total:t("total"),tiao:t("tiao")}))),o=y({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:e})=>`${l.value.total} ${e} ${l.value.tiao}`,onUpdatePage:a=>{o.page=a,e()},onUpdatePageSize:a=>{o.page=1,o.pageSize=a,e()}});return{pagination:o}})(U);i&&U();const A=a((()=>({edit:!(1===j.value.length),del:!(j.value.length>0),download:o&&V.itemCount<=0})));return{modalVisible:w,modalAction:S,modalTitle:_,modalLoading:x,modalShowFooter:F,handlereset:()=>{D.value={...n}},handleAdd:()=>{S.value="add",w.value=!0,B.value={...d}},handleDelete:e=>{if(e&&0===e.length&&T.value&&0===T.value.length)return;let a=e;e||(a=T.value);const t=R.warning({title:f("warn"),content:f("dureDelete"),positiveText:f("determine"),negativeText:f("cancellation"),onPositiveClick:async()=>{t.loading=!0;try{u&&await u(a),t.loading=!1,u&&z.success(f("delete")+" "+f("sucess")),U()}catch(e){t.loading=!1}},onNegativeClick:()=>{}})},handleEdit:e=>{let a=k(e);!e&&P.value&&(a=P.value[0]),S.value="edit",w.value=!0,B.value=a},handleView:e=>{S.value="view",w.value=!0,B.value=k(e)},handleDownload:()=>{},handleSave:()=>{var e;["edit","add"].includes(S.value)?null==(e=$.value)||e.validate((async e=>{if(e)return;const a="add"===S.value?s:r,t="add"===S.value?f("add"):f("edit");try{x.value=!0;const e=p&&p(B.value)||B.value;a&&await a(e),h&&h(),a&&z.success(t+" "+f("sucess")),x.value=w.value=!1,U()}catch(l){x.value=!1}})):w.value=!1},modalForm:B,modalFormRef:$,defualtQuery:D,changeCheckRow:Q,loading:E,listData:K,pagination:V,listQuery:U,rowKey:e=>e[l],btnDisabled:A}};export{D as _,$ as a,_ as u};
