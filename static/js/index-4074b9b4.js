import{d as K,j as h,l as b,a8 as $,af as we,bt as g,aa as ge,aU as G,q as H,B as D,u as he,f as ye,O as _e,aW as ke,b6 as I,a9 as q,K as X,v as O,a as w}from"./@vue-b1321081.js";import{g as Z,j as Ce,p as Se}from"./naive-ui-e3a37dce.js";import{h as ee,s as F,t as L,v as Y,w as be}from"./index-54c8dad2.js";import{u as te}from"./vue-i18n-d9dd9a4c.js";import{c as V}from"./lodash-es-000674ce.js";const $e={flex:"","justify-end":""},De=K({name:"BaseModel"}),Ue=K({...De,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(s,{emit:l}){const d=s,n=l,t=h({get(){return d.visible},set(o){n("update:visible",o)}});return(o,r)=>{const y=Z,u=Ce;return b(),$(u,{show:he(t),"onUpdate:show":r[2]||(r[2]=m=>ye(t)?t.value=m:null),style:_e({width:o.width}),preset:"card",title:o.title,size:"huge",bordered:!1},we({default:g(()=>[G(o.$slots,"default")]),_:2},[o.showFooter?{name:"footer",fn:g(()=>[ge("footer",$e,[G(o.$slots,"footer",{},()=>[H(y,{onClick:r[0]||(r[0]=m=>t.value=!1)},{default:g(()=>[D("取消")]),_:1}),H(y,{loading:o.loading,"ml-20":"",type:"primary",onClick:r[1]||(r[1]=m=>n("save"))},{default:g(()=>[D("保存")]),_:1},8,["loading"])])])]),key:"0"}:void 0]),1032,["show","style","title"])}}}),ze=K({name:"TableAction"}),xe=K({...ze,props:{optShow:{default:()=>({view:!0,edit:!0,del:!0})},disabled:{type:Boolean,default:!1},permission:{default:()=>({edit:[],del:[]})}},emits:["handleView","handleEdit","handleDelete"],setup(s,{emit:l}){const d=s,n=l;return(t,o)=>{const r=Z,y=Se,u=ke("permission");return b(),$(y,{justify:"center"},{default:g(()=>[d.optShow.view?(b(),$(r,{key:0,type:"info",text:"",size:"small",onClick:o[0]||(o[0]=m=>n("handleView"))},{default:g(()=>[D(I(t.$t("view")),1)]),_:1})):q("",!0),d.optShow.edit?X((b(),$(r,{key:1,disabled:t.disabled,type:"warning",text:"",size:"small",onClick:o[1]||(o[1]=m=>n("handleEdit"))},{default:g(()=>[D(I(t.$t("edit")),1)]),_:1},8,["disabled"])),[[u,t.permission.edit]]):q("",!0),d.optShow.del?X((b(),$(r,{key:2,disabled:t.disabled,type:"error",text:"",size:"small",onClick:o[2]||(o[2]=m=>n("handleDelete"))},{default:g(()=>[D(I(t.$t("delete")),1)]),_:1},8,["disabled"])),[[u,t.permission.del]]):q("",!0)]),_:1})}}}),Be=(s,l)=>ee.get(s,l),Te=s=>{const{t:l}=te(),d=h(()=>({total:l("total"),tiao:l("tiao")})),n=O({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:t})=>`${d.value.total} ${t} ${d.value.tiao}`,onUpdatePage:t=>{n.page=t,s()},onUpdatePageSize:t=>{n.page=1,n.pageSize=t,s()}});return{pagination:n}},Pe=(s,l)=>ee.post(s,l,{responseType:"blob"}),Ne=()=>{const s=w([]),l=w([]);return{checkedRowKeys:s,changeCheckRow:(n,t)=>{s.value=n,l.value=V(t)},checkedRow:l}},Ie=({name:s,url:l,key:d="id",isPagination:n=!0,isInitQuery:t=!0,initForm:o={},initQuery:r={},doCreate:y,doDelete:u,doUpdate:m,beforeRefresh:A,afterRefresh:J,beforeValidate:z,beforeAsyncValidate:B,beforeSave:M,afterSave:Q})=>{const{t:i}=te(),ae=h(()=>({view:i("view"),edit:i("edit"),add:i("add")})),_=w(!1),c=w("add"),T=w(!1),W=w(null),f=O({...o,[d]:void 0}),C=O({...r}),oe=h(()=>ae.value[c.value]+" "+(s||"")),ne=h(()=>c.value!=="view"),se=e=>e[d],le=()=>{F(C,r)},{changeCheckRow:ie,checkedRowKeys:P,checkedRow:N}=Ne(),de=async()=>{z&&z(f),B&&await B(),c.value="add",_.value=!0,F(f,o)},re=async e=>{z&&z(f),B&&await B();let a=V(e);!e&&N.value&&(a=N.value[0]),c.value="edit",_.value=!0,F(f,a)},ue=e=>{c.value="view",_.value=!0,F(f,V(e))},ce=()=>{var e;if(!["edit","add"].includes(c.value)){_.value=!1;return}(e=W.value)==null||e.validate(async a=>{if(a)return;const v=c.value==="add"?y:m,k=c.value==="add"?i("add"):i("edit");try{T.value=!0;const E=M&&M(f)||f;if(v){const fe=await v(E);L.success({title:"",content:k+" "+i("sucess"),duration:1600}),Q&&Q(c.value,fe),T.value=_.value=!1,S()}}catch{T.value=!1}})},R=h(()=>{var e;return(e=N.value)==null?void 0:e.map(a=>a[d])}),pe=e=>{if(e===void 0&&R.value&&R.value.length===0)return;const a=Y.warning({title:i("warn"),content:i("dureDelete"),positiveText:i("determine"),negativeText:i("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{if(R.value,e!==void 0)u&&await u(e);else{const v=R.value.map(async k=>{if(u)return await u(k)});await Promise.all(v)}a.loading=!1,u&&L.success({title:"",content:i("delete")+" "+i("sucess"),duration:1600}),S()}catch{a.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},j=w(!1),U=w(),S=async()=>{j.value=!0;try{let e={...C};n&&(e={page:(p==null?void 0:p.page)||0,pageSize:(p==null?void 0:p.pageSize)||10,...C});const a=A&&A(e);if(typeof a=="boolean"&&!a)return;a&&typeof a!="boolean"&&(e=a);const v=await Be(l,e),{data:k,total:x}=v.data,E=J&&J([...k]);E?U.value=E||[]:U.value=k||[],n&&(p.itemCount=x||0),N.value=[],P.value=[],j.value=!1}catch{j.value=!1}},{pagination:p}=Te(S);t&&S();const ve=async()=>{const e=Y.warning({title:"导出数据",content:"是否导出数据？",positiveText:i("determine"),negativeText:i("cancellation"),onPositiveClick:async()=>{e.loading=!0;try{const a={...C},v=await Pe(l+"/download",a);be(v,s),e.loading=!1,L.success({title:"",content:"导出成功",duration:1600})}catch{e.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},me=h(()=>({edit:P.value.length!==1,del:!(P.value.length>0),download:n&&p.itemCount<=0}));return{modalVisible:_,modalAction:c,modalTitle:oe,modalLoading:T,modalShowFooter:ne,handlereset:le,handleAdd:de,handleDelete:pe,handleEdit:re,handleView:ue,handleDownload:ve,handleSave:ce,modalForm:f,modalFormRef:W,defualtQuery:C,changeCheckRow:ie,loading:j,listData:U,pagination:p,listQuery:S,rowKey:se,btnDisabled:me,checkedRowKeys:P}};export{xe as _,Ue as a,Ie as u};
