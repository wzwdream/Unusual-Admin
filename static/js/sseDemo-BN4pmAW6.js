import{n as C,h as J}from"./index-CbgEwbzS.js";import{D as O,B as H,T as I,n as K,l as R,j as T,q as G,k as P}from"./naive-ui-Bk4TGpAc.js";import{d as $,a as b,b as Q,v as W,l as f,m as d,ag as o,y as r,bK as n,E as g,bj as c,ae as x,af as y,F as z,b4 as L}from"./@vue-BxoxtTAP.js";import"./@vueuse-DrRc1vxu.js";import"./pinia-CmUssEbr.js";import"./vue-i18n-D8g7FhYN.js";import"./@intlify-ZcBRI--x.js";import"./vue-echarts-CTGpP_pZ.js";import"./resize-detector-G6vbKCU7.js";import"./echarts-CuRpVpP4.js";import"./zrender-DGX4euIw.js";import"./tslib-BDyQ-Jie.js";import"./vue-router-dgZRC-ml.js";import"./@iconify-CL9SbJpr.js";import"./axios-B9ygI19o.js";import"./@codemirror-Dl84AIwu.js";import"./@lezer-BKSZuLkY.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./lodash-es-DkZVwyoF.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./date-fns-CMuzgvE5.js";import"./vueuc-CJldP7Lx.js";import"./evtd-CI_DDEu_.js";import"./seemly-DXTCRGqE.js";import"./@css-render-EhH995Cp.js";import"./vooks-Cw9CgJAa.js";import"./vdirs-DRH9Xvnd.js";import"./@juggle-C8OzoCMD.js";import"./css-render-BDrvWz3H.js";import"./@emotion-WldOFDRm.js";import"./treemate-DKekKYbv.js";import"./async-validator-9PlIezaS.js";const X={class:"w-full h-full flex flex-col p-5 box-border overflow-hidden"},Y={class:"flex justify-between items-center mb-5"},Z={class:"flex items-center"},ee={class:"flex flex-1 gap-5 overflow-hidden"},te={class:"flex-1 flex flex-col gap-5 min-w-[300px] overflow-hidden"},oe={class:"flex flex-col gap-4 p-5 rounded-lg border border-gray-200 bg-gray-50 flex-shrink-0"},se={class:"flex flex-col gap-2.5"},ne={class:"flex flex-col rounded-lg border border-gray-200 overflow-hidden bg-gray-50 flex-1"},re={class:"flex-1 overflow-y-auto p-3 box-border message-scroll-container",style:{"min-height":"100px"}},le={class:"text-[12px] text-gray-500"},ae={class:"flex-1"},ie={class:"font-semibold mb-1 text-[14px]"},ce={class:"word-break-all text-[14px] leading-[1.5] text-gray-600"},de={class:"flex-2 flex flex-col gap-5 min-w-[400px] overflow-hidden"},pe={class:"flex flex-col rounded-lg border border-gray-200 overflow-hidden box-border flex-1"},ue={class:"flex-1 overflow-y-auto p-3 box-border"},me={class:"text-[12px] text-gray-500"},_e={class:"flex-1"},fe={class:"font-semibold mb-1 text-[14px]"},xe={key:0,class:"mb-1"},ve={class:"word-break-all text-[14px] leading-[1.5] text-gray-600"},be={class:"flex flex-col rounded-lg border border-gray-200 overflow-hidden box-border flex-1"},ge={class:"flex-1 overflow-y-auto p-3 box-border"},ye={class:"text-[12px] text-gray-500"},he={class:"flex-1"},Se={class:"font-semibold mb-1 text-[14px]"},we={key:0,class:"mb-1"},Ee={class:"word-break-all text-[14px] leading-[1.5] text-gray-600"},ke=$({name:"SseDemo"}),it=$({...ke,setup(De){const l=b("disconnected"),p=b([]),u=b(""),S=b(""),M=b(["","chat","notification","update","alert"]);let a=null;const w=s=>{const t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],i=t[Math.floor(Math.random()*t.length)];return`https://ui-avatars.com/api/?name=${encodeURIComponent(s.sender)}&background=${i.replace("#","")}&color=fff&size=32`},j=()=>{a&&a.close(),l.value="connecting";try{a=new EventSource("/api/sse/connect"),a.onopen=()=>{l.value="connected",m("SSE连接已建立")},a.onmessage=s=>{try{const t=JSON.parse(s.data);E("服务器",t.data,new Date().toLocaleString(),t.event)}catch(t){console.error("解析SSE消息失败:",t),m("接收到无效的消息格式")}},M.value.forEach(s=>{s&&a&&a.addEventListener(s,t=>{try{const i=JSON.parse(t.data);E("服务器",i.data,new Date().toLocaleString(),s)}catch(i){console.error(`解析${s}事件消息失败:`,i),m(`接收到无效的${s}事件消息格式`)}})}),a.onerror=s=>{console.error("SSE连接错误:",s),l.value="disconnected",m("SSE连接发生错误，已断开"),C.error({title:"SSE连接错误",content:"SSE连接发生错误，已断开",duration:3e3}),a==null||a.close()}}catch(s){console.error("创建SSE连接失败:",s),l.value="disconnected",m("建立SSE连接失败"),C.error({title:"SSE连接失败",content:"建立SSE连接失败",duration:3e3})}},F=()=>{a&&(a.close(),a=null),l.value="disconnected",m("SSE连接已断开")},A=()=>{l.value==="connected"?F():j()},m=s=>{p.value.push({sender:"系统",content:s,timestamp:new Date().toLocaleString()}),N()},E=(s,t,i,h)=>{p.value.push({sender:s,content:t,timestamp:i,event:h}),N()},U=async()=>{if(!u.value.trim())return;const s=u.value.trim(),t=S.value;u.value="",E("我",s,new Date().toLocaleString(),t);try{await J.post("/sse/send",{content:s,event:t})}catch(i){console.error("发送消息失败:",i),C.error({title:"发送失败",content:"消息发送失败，请重试",duration:3e3}),p.value.pop()}},N=()=>{setTimeout(()=>{document.querySelectorAll(".message-scroll-container").forEach(t=>{t.scrollTop=t.scrollHeight})},100)};return Q(()=>{j()}),W(()=>{F()}),(s,t)=>{const i=O,h=H,V=I,q=K,k=T,_=R,D=G,B=P;return d(),f("div",X,[o("div",Y,[t[3]||(t[3]=o("h2",{class:"m-0 text-[20px] font-semibold"},"SSE 实时消息推送演示",-1)),o("div",Z,[t[2]||(t[2]=o("span",null,"连接状态：",-1)),r(i,{type:l.value==="connecting"?"warning":l.value==="connected"?"success":"error"},{default:n(()=>[g(c(l.value==="connecting"?"连接中":l.value==="connected"?"已连接":"已断开"),1)]),_:1},8,["type"]),r(h,{type:"primary",size:"small",disabled:l.value==="connecting",onClick:A,class:"ml-2.5"},{default:n(()=>[g(c(l.value==="connected"?"断开连接":"建立连接"),1)]),_:1},8,["disabled"])])]),o("div",ee,[o("div",te,[o("div",oe,[t[5]||(t[5]=o("h3",{class:"m-0 text-[16px] font-semibold text-gray-800"},"发送消息",-1)),o("div",se,[r(V,{value:S.value,"onUpdate:value":t[0]||(t[0]=e=>S.value=e),options:M.value.map(e=>({label:e||"默认事件",value:e})),placeholder:"选择事件类型",size:"large",class:"w-full mb-2.5"},null,8,["value","options"]),r(q,{value:u.value,"onUpdate:value":t[1]||(t[1]=e=>u.value=e),type:"textarea",placeholder:"请输入消息内容",rows:6,disabled:l.value!=="connected",class:"w-full mb-2.5"},null,8,["value","disabled"])]),r(h,{type:"primary",size:"large",disabled:!u.value.trim()||l.value!=="connected",onClick:U,block:""},{default:n(()=>[...t[4]||(t[4]=[g(" 发送消息 ",-1)])]),_:1},8,["disabled"])]),o("div",ne,[t[6]||(t[6]=o("h3",{class:"m-0 p-3 text-[16px] font-semibold text-gray-800 bg-gray-100 border-b border-gray-200"},"系统消息",-1)),o("div",re,[r(B,{bordered:""},{default:n(()=>[p.value.filter(e=>e.sender==="系统").length===0?(d(),x(_,{key:0,class:"flex justify-center items-center py-[100px]"},{default:n(()=>[r(k,{description:"暂无系统消息"})]),_:1})):y("",!0),(d(!0),f(z,null,L(p.value.filter(e=>e.sender==="系统"),(e,v)=>(d(),x(_,{key:v,class:"mb-2.5 rounded transition-colors hover:bg-gray-100 bg-yellow-50"},{prefix:n(()=>[r(D,{size:32,src:w(e)},null,8,["src"])]),suffix:n(()=>[o("span",le,c(e.timestamp),1)]),default:n(()=>[o("div",ae,[o("div",ie,c(e.sender),1),o("div",ce,c(e.content),1)])]),_:2},1024))),128))]),_:1})])])]),o("div",de,[o("div",pe,[t[7]||(t[7]=o("h3",{class:"m-0 p-3 text-[16px] font-semibold text-gray-800 bg-gray-50 border-b border-gray-200"},"我的消息",-1)),o("div",ue,[r(B,{bordered:""},{default:n(()=>[p.value.filter(e=>e.sender==="我").length===0?(d(),x(_,{key:0,class:"flex justify-center items-center py-[100px]"},{default:n(()=>[r(k,{description:"暂无消息"})]),_:1})):y("",!0),(d(!0),f(z,null,L(p.value.filter(e=>e.sender==="我"),(e,v)=>(d(),x(_,{key:v,class:"mb-2.5 rounded transition-colors hover:bg-gray-100 bg-blue-50"},{prefix:n(()=>[r(D,{size:32,src:w(e)},null,8,["src"])]),suffix:n(()=>[o("span",me,c(e.timestamp),1)]),default:n(()=>[o("div",_e,[o("div",fe,c(e.sender),1),e.event?(d(),f("div",xe,[r(i,{size:"small",type:"info"},{default:n(()=>[g(c(e.event),1)]),_:2},1024)])):y("",!0),o("div",ve,c(e.content),1)])]),_:2},1024))),128))]),_:1})])]),o("div",be,[t[8]||(t[8]=o("h3",{class:"m-0 p-3 text-[16px] font-semibold text-gray-800 bg-gray-50 border-b border-gray-200"},"服务器消息",-1)),o("div",ge,[r(B,{bordered:""},{default:n(()=>[p.value.filter(e=>e.sender==="服务器").length===0?(d(),x(_,{key:0,class:"flex justify-center items-center py-[100px]"},{default:n(()=>[r(k,{description:"暂无消息，建立连接后开始接收消息"})]),_:1})):y("",!0),(d(!0),f(z,null,L(p.value.filter(e=>e.sender==="服务器"),(e,v)=>(d(),x(_,{key:v,class:"mb-2.5 rounded transition-colors hover:bg-gray-100 bg-gray-50"},{prefix:n(()=>[r(D,{size:32,src:w(e)},null,8,["src"])]),suffix:n(()=>[o("span",ye,c(e.timestamp),1)]),default:n(()=>[o("div",he,[o("div",Se,c(e.sender),1),e.event?(d(),f("div",we,[r(i,{size:"small",type:"success"},{default:n(()=>[g(c(e.event),1)]),_:2},1024)])):y("",!0),o("div",Ee,c(e.content),1)])]),_:2},1024))),128))]),_:1})])])])])])}}});export{it as default};
