import{d as K,j as h,ae as $,m as D,al as ge,bK as g,ag as he,b5 as W,y as X,E as z,S as ye,f as ke,u as Ce,b7 as be,af as U,L as Y,bj as q,q as V,a as w,p as j}from"./@vue-BxoxtTAP.js";import{B as ee,o as Se,m as $e}from"./naive-ui-BLfgJAqn.js";import{h as te,A,B as Z,C as De,D as F}from"./index-EnRswSS-.js";import{u as ae}from"./vue-i18n-D8g7FhYN.js";import{c as J}from"./lodash-es-DkZVwyoF.js";const ze={flex:"","justify-end":""},Be=K({name:"BaseModel"}),Ie=K({...Be,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(t,{emit:l}){const u=t,n=l,o=h({get(){return u.visible},set(i){n("update:visible",i)}});return(i,s)=>{const y=ee,r=Se;return D(),$(r,{show:Ce(o),"onUpdate:show":s[2]||(s[2]=p=>ke(o)?o.value=p:null),style:ye({width:t.width}),preset:"card",title:t.title,size:"huge",bordered:!1},ge({default:g(()=>[W(i.$slots,"default")]),_:2},[t.showFooter?{name:"footer",fn:g(()=>[he("footer",ze,[W(i.$slots,"footer",{},()=>[X(y,{onClick:s[0]||(s[0]=p=>o.value=!1)},{default:g(()=>[...s[3]||(s[3]=[z("取消",-1)])]),_:1}),X(y,{loading:t.loading,"ml-20":"",type:"primary",onClick:s[1]||(s[1]=p=>n("save"))},{default:g(()=>[...s[4]||(s[4]=[z("保存",-1)])]),_:1},8,["loading"])])])]),key:"0"}:void 0]),1032,["show","style","title"])}}}),xe=K({name:"TableAction"}),Le=K({...xe,props:{optShow:{default:()=>({view:!0,edit:!0,del:!0})},disabled:{type:Boolean,default:!1},permission:{default:()=>({edit:[],del:[]})}},emits:["handleView","handleEdit","handleDelete"],setup(t,{emit:l}){const u=t,n=l;return(o,i)=>{const s=ee,y=$e,r=be("permission");return D(),$(y,{justify:"center"},{default:g(()=>[u.optShow.view?(D(),$(s,{key:0,type:"info",text:"",size:"small",onClick:i[0]||(i[0]=p=>n("handleView"))},{default:g(()=>[z(q(o.$t("view")),1)]),_:1})):U("",!0),u.optShow.edit?Y((D(),$(s,{key:1,disabled:t.disabled,type:"warning",text:"",size:"small",onClick:i[1]||(i[1]=p=>n("handleEdit"))},{default:g(()=>[z(q(o.$t("edit")),1)]),_:1},8,["disabled"])),[[r,t.permission.edit]]):U("",!0),u.optShow.del?Y((D(),$(s,{key:2,disabled:t.disabled,type:"error",text:"",size:"small",onClick:i[2]||(i[2]=p=>n("handleDelete"))},{default:g(()=>[z(q(o.$t("delete")),1)]),_:1},8,["disabled"])),[[r,t.permission.del]]):U("",!0)]),_:1})}}}),_e=(t,l)=>te.get(t,l),Te=t=>{const{t:l}=ae(),u=h(()=>({total:l("total"),tiao:l("tiao")})),n=V({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:o})=>`${u.value.total} ${o} ${u.value.tiao}`,onUpdatePage:o=>{n.page=o,t()},onUpdatePageSize:o=>{n.page=1,n.pageSize=o,t()}});return{pagination:n}},Pe=(t,l)=>te.post(t,l,{responseType:"blob"}),Re=()=>{const t=w([]),l=w([]);return{checkedRowKeys:t,changeCheckRow:(n,o)=>{t.value=n,l.value=J(o)},checkedRow:l}},Ue=({name:t,url:l,key:u="id",isPagination:n=!0,isInitQuery:o=!0,initForm:i={},initQuery:s={},doCreate:y,doDelete:r,doUpdate:p,beforeRefresh:M,afterRefresh:O,beforeValidate:B,beforeAsyncValidate:x,beforeSave:Q,afterSave:G})=>{const{t:d}=ae(),oe=h(()=>({view:d("view"),edit:d("edit"),add:d("add")})),k=w(!1),c=w("add"),_=w(!1),H=w(null),f=V({...i,[u]:void 0}),b=V({...s}),ne=h(()=>oe.value[c.value]+" "+(t||"")),se=h(()=>c.value!=="view"),le=e=>e[u],ie=()=>{F(b,s)},{changeCheckRow:de,checkedRowKeys:T,checkedRow:P}=Re(),ue=async()=>{B&&B(j(f)),x&&await x(),c.value="add",k.value=!0,F(f,i)},re=async e=>{B&&B(j(f)),x&&await x();let a=J(e);!e&&P.value&&(a=P.value[0]),c.value="edit",k.value=!0,F(f,a)},ce=e=>{c.value="view",k.value=!0,F(f,J(e))},ve=()=>{var e;if(!["edit","add"].includes(c.value)){k.value=!1;return}(e=H.value)==null||e.validate(async a=>{if(a)return;const m=c.value==="add"?y:p,C=c.value==="add"?d("add"):d("edit");try{_.value=!0;const E=Q&&Q(j(f))||j(f);if(m){const we=await m(E);A.success({title:"",content:C+" "+d("sucess"),duration:1600}),G&&G(c.value,we),_.value=k.value=!1,S()}}catch{_.value=!1}})},R=h(()=>{var e;return(e=P.value)==null?void 0:e.map(a=>a[u])}),me=e=>{if(e===void 0&&R.value&&R.value.length===0)return;const a=Z.warning({title:d("warn"),content:d("dureDelete"),positiveText:d("determine"),negativeText:d("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{if(R.value,e!==void 0)r&&await r(e);else{const m=R.value.map(async C=>{if(r)return await r(C)});await Promise.all(m)}a.loading=!1,r&&A.success({title:"",content:d("delete")+" "+d("sucess"),duration:1600}),S()}catch{a.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},N=w(!1),I=w(),S=async()=>{N.value=!0;try{let e={...b};n&&(e={page:(v==null?void 0:v.page)||0,pageSize:(v==null?void 0:v.pageSize)||10,...b});const a=M&&M(e);if(typeof a=="boolean"&&!a)return;a&&typeof a!="boolean"&&(e=a);const m=await _e(l,e),{data:C,total:L}=m.data,E=O&&O([...C]);E?I.value=E||[]:I.value=C||[],n&&(v.itemCount=L||0),P.value=[],T.value=[],N.value=!1}catch{N.value=!1}},{pagination:v}=Te(S);o&&S();const pe=async()=>{const e=Z.warning({title:"导出数据",content:"是否导出数据？",positiveText:d("determine"),negativeText:d("cancellation"),onPositiveClick:async()=>{e.loading=!0;try{const a={...b},m=await Pe(l+"/download",a);De(m,t),e.loading=!1,A.success({title:"",content:"导出成功",duration:1600})}catch{e.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},fe=h(()=>({edit:T.value.length!==1,del:!(T.value.length>0),download:n&&v.itemCount<=0}));return{modalVisible:k,modalAction:c,modalTitle:ne,modalLoading:_,modalShowFooter:se,handlereset:ie,handleAdd:ue,handleDelete:me,handleEdit:re,handleView:ce,handleDownload:pe,handleSave:ve,modalForm:f,modalFormRef:H,defualtQuery:b,changeCheckRow:de,loading:N,listData:I,pagination:v,listQuery:S,rowKey:le,btnDisabled:fe,checkedRowKeys:T}};export{Le as _,Ie as a,Ue as u};
