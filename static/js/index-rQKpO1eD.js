import{d as e,j as a,l as t,ad as l,ak as i,by as o,af as n,aZ as s,q as d,B as u,u as r,f as v,P as c,a$ as p,bb as h,ae as f,L as w,v as m,a as g}from"./@vue-7s647Hg9.js";import{B as y,i as b,n as k}from"./naive-ui-DtZk0WJ8.js";import{h as C,s as S,t as x,v as z,w as R}from"./index-BYCMBCbo.js";import{u as $}from"./vue-i18n-Af_yDAzr.js";import{c as j}from"./lodash-es-BqiBNFWB.js";const D={flex:"","justify-end":""},P=e({name:"BaseModel"}),_=e({...P,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(e,{emit:p}){const h=e,f=p,w=a({get:()=>h.visible,set(e){f("update:visible",e)}});return(e,a)=>{const p=y,h=b;return t(),l(h,{show:r(w),"onUpdate:show":a[2]||(a[2]=e=>v(w)?w.value=e:null),style:c({width:e.width}),preset:"card",title:e.title,size:"huge",bordered:!1},i({default:o((()=>[s(e.$slots,"default")])),_:2},[e.showFooter?{name:"footer",fn:o((()=>[n("footer",D,[s(e.$slots,"footer",{},(()=>[d(p,{onClick:a[0]||(a[0]=e=>w.value=!1)},{default:o((()=>[u("取消")])),_:1}),d(p,{loading:e.loading,"ml-20":"",type:"primary",onClick:a[1]||(a[1]=e=>f("save"))},{default:o((()=>[u("保存")])),_:1},8,["loading"])]))])])),key:"0"}:void 0]),1032,["show","style","title"])}}}),B=e({name:"TableAction"}),T=e({...B,props:{optShow:{default:()=>({view:!0,edit:!0,del:!0})},disabled:{type:Boolean,default:!1},permission:{default:()=>({edit:[],del:[]})}},emits:["handleView","handleEdit","handleDelete"],setup(e,{emit:a}){const i=e,n=a;return(e,a)=>{const s=y,d=k,r=p("permission");return t(),l(d,{justify:"center"},{default:o((()=>[i.optShow.view?(t(),l(s,{key:0,type:"info",text:"",size:"small",onClick:a[0]||(a[0]=e=>n("handleView"))},{default:o((()=>[u(h(e.$t("view")),1)])),_:1})):f("",!0),i.optShow.edit?w((t(),l(s,{key:1,disabled:e.disabled,type:"warning",text:"",size:"small",onClick:a[1]||(a[1]=e=>n("handleEdit"))},{default:o((()=>[u(h(e.$t("edit")),1)])),_:1},8,["disabled"])),[[r,e.permission.edit]]):f("",!0),i.optShow.del?w((t(),l(s,{key:2,disabled:e.disabled,type:"error",text:"",size:"small",onClick:a[2]||(a[2]=e=>n("handleDelete"))},{default:o((()=>[u(h(e.$t("delete")),1)])),_:1},8,["disabled"])),[[r,e.permission.del]]):f("",!0)])),_:1})}}}),V=({name:e,url:t,key:l="id",isPagination:i=!0,isInitQuery:o=!0,initForm:n={},initQuery:s={},doCreate:d,doDelete:u,doUpdate:r,beforeRefresh:v,afterRefresh:c,beforeValidate:p,beforeAsyncValidate:h,beforeSave:f,afterSave:w})=>{const{t:y}=$(),b=a((()=>({view:y("view"),edit:y("edit"),add:y("add")}))),k=g(!1),D=g("add"),P=g(!1),_=g(null),B=m({...n,[l]:void 0}),T=m({...s}),V=a((()=>b.value[D.value]+" "+(e||""))),F=a((()=>"view"!==D.value)),{changeCheckRow:Q,checkedRowKeys:A,checkedRow:K}=(()=>{const e=g([]),a=g([]);return{checkedRowKeys:e,changeCheckRow:(t,l)=>{e.value=t,a.value=j(l)},checkedRow:a}})(),U=a((()=>{var e;return null==(e=K.value)?void 0:e.map((e=>e[l]))})),E=g(!1),J=g(),L=async()=>{E.value=!0;try{let e={...T};i&&(e={page:(null==N?void 0:N.page)||0,pageSize:(null==N?void 0:N.pageSize)||10,...T});const a=v&&v(e);if("boolean"==typeof a&&!a)return;a&&"boolean"!=typeof a&&(e=a);const l=await((e,a)=>C.get(e,a))(t,e),{data:o,total:n}=l.data,s=c&&c([...o]);J.value=s?s||[]:o||[],i&&(N.itemCount=n||0),K.value=[],A.value=[],E.value=!1}catch(e){E.value=!1}},{pagination:N}=(e=>{const{t:t}=$(),l=a((()=>({total:t("total"),tiao:t("tiao")}))),i=m({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:e})=>`${l.value.total} ${e} ${l.value.tiao}`,onUpdatePage:a=>{i.page=a,e()},onUpdatePageSize:a=>{i.page=1,i.pageSize=a,e()}});return{pagination:i}})(L);o&&L();const q=a((()=>({edit:!(1===A.value.length),del:!(A.value.length>0),download:i&&N.itemCount<=0})));return{modalVisible:k,modalAction:D,modalTitle:V,modalLoading:P,modalShowFooter:F,handlereset:()=>{S(T,s)},handleAdd:async()=>{p&&p(B.value),h&&await h(),D.value="add",k.value=!0,S(B.value,n)},handleDelete:e=>{if(void 0===e&&U.value&&0===U.value.length)return;const a=z.warning({title:y("warn"),content:y("dureDelete"),positiveText:y("determine"),negativeText:y("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{if(U.value,void 0!==e)u&&await u(e);else{const e=U.value.map((async e=>{if(u)return await u(e)}));await Promise.all(e)}a.loading=!1,u&&x.success({title:"",content:y("delete")+" "+y("sucess"),duration:1600}),L()}catch(t){a.loading=!1}},onNegativeClick:()=>{}})},handleEdit:async e=>{p&&p(B.value),h&&await h();let a=j(e);!e&&K.value&&(a=K.value[0]),D.value="edit",k.value=!0,S(B.value,a)},handleView:e=>{D.value="view",k.value=!0,S(B.value,j(e))},handleDownload:async()=>{const a=z.warning({title:"导出数据",content:"是否导出数据？",positiveText:y("determine"),negativeText:y("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{const l={...T},i=await((e,a)=>C.post(e,a,{responseType:"blob"}))(t+"/download",l);R(i,e),a.loading=!1,x.success({title:"",content:"导出成功",duration:1600})}catch(l){a.loading=!1}},onNegativeClick:()=>{}})},handleSave:()=>{var e;["edit","add"].includes(D.value)?null==(e=_.value)||e.validate((async e=>{if(e)return;const a="add"===D.value?d:r,t="add"===D.value?y("add"):y("edit");try{P.value=!0;const e=f&&f(B.value)||B.value;if(a){const l=await a(e);x.success({title:"",content:t+" "+y("sucess"),duration:1600}),w&&w(D.value,l),P.value=k.value=!1,L()}}catch(l){P.value=!1}})):k.value=!1},modalForm:B,modalFormRef:_,defualtQuery:T,changeCheckRow:Q,loading:E,listData:J,pagination:N,listQuery:L,rowKey:e=>e[l],btnDisabled:q,checkedRowKeys:A}};export{T as _,_ as a,V as u};
