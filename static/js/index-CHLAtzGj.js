import{d as I,j as h,l as S,ad as $,ak as ge,by as g,af as he,aZ as H,q as W,B as D,u as ye,f as ke,P as _e,a$ as Ce,bb as U,ae as q,L as X,v as A,a as w,p as j}from"./@vue-CRj7PaMA.js";import{B as ee,i as be,n as Se}from"./naive-ui-ItunR-2b.js";import{h as te,s as x,t as V,v as Y,w as $e}from"./index-D4B603rM.js";import{u as ae}from"./vue-i18n-BZ7cv-U7.js";import{c as J}from"./lodash-es-q_UuXcXk.js";const De={flex:"","justify-end":""},ze=I({name:"BaseModel"}),Ke=I({...ze,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(s,{emit:l}){const d=s,n=l,t=h({get(){return d.visible},set(o){n("update:visible",o)}});return(o,r)=>{const y=ee,u=be;return S(),$(u,{show:ye(t),"onUpdate:show":r[2]||(r[2]=m=>ke(t)?t.value=m:null),style:_e({width:o.width}),preset:"card",title:o.title,size:"huge",bordered:!1},ge({default:g(()=>[H(o.$slots,"default")]),_:2},[o.showFooter?{name:"footer",fn:g(()=>[he("footer",De,[H(o.$slots,"footer",{},()=>[W(y,{onClick:r[0]||(r[0]=m=>t.value=!1)},{default:g(()=>[D("取消")]),_:1}),W(y,{loading:o.loading,"ml-20":"",type:"primary",onClick:r[1]||(r[1]=m=>n("save"))},{default:g(()=>[D("保存")]),_:1},8,["loading"])])])]),key:"0"}:void 0]),1032,["show","style","title"])}}}),Be=I({name:"TableAction"}),Le=I({...Be,props:{optShow:{default:()=>({view:!0,edit:!0,del:!0})},disabled:{type:Boolean,default:!1},permission:{default:()=>({edit:[],del:[]})}},emits:["handleView","handleEdit","handleDelete"],setup(s,{emit:l}){const d=s,n=l;return(t,o)=>{const r=ee,y=Se,u=Ce("permission");return S(),$(y,{justify:"center"},{default:g(()=>[d.optShow.view?(S(),$(r,{key:0,type:"info",text:"",size:"small",onClick:o[0]||(o[0]=m=>n("handleView"))},{default:g(()=>[D(U(t.$t("view")),1)]),_:1})):q("",!0),d.optShow.edit?X((S(),$(r,{key:1,disabled:t.disabled,type:"warning",text:"",size:"small",onClick:o[1]||(o[1]=m=>n("handleEdit"))},{default:g(()=>[D(U(t.$t("edit")),1)]),_:1},8,["disabled"])),[[u,t.permission.edit]]):q("",!0),d.optShow.del?X((S(),$(r,{key:2,disabled:t.disabled,type:"error",text:"",size:"small",onClick:o[2]||(o[2]=m=>n("handleDelete"))},{default:g(()=>[D(U(t.$t("delete")),1)]),_:1},8,["disabled"])),[[u,t.permission.del]]):q("",!0)]),_:1})}}}),Pe=(s,l)=>te.get(s,l),Te=s=>{const{t:l}=ae(),d=h(()=>({total:l("total"),tiao:l("tiao")})),n=A({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:t})=>`${d.value.total} ${t} ${d.value.tiao}`,onUpdatePage:t=>{n.page=t,s()},onUpdatePageSize:t=>{n.page=1,n.pageSize=t,s()}});return{pagination:n}},Re=(s,l)=>te.post(s,l,{responseType:"blob"}),Ne=()=>{const s=w([]),l=w([]);return{checkedRowKeys:s,changeCheckRow:(n,t)=>{s.value=n,l.value=J(t)},checkedRow:l}},Ue=({name:s,url:l,key:d="id",isPagination:n=!0,isInitQuery:t=!0,initForm:o={},initQuery:r={},doCreate:y,doDelete:u,doUpdate:m,beforeRefresh:M,afterRefresh:O,beforeValidate:z,beforeAsyncValidate:B,beforeSave:Q,afterSave:Z})=>{const{t:i}=ae(),oe=h(()=>({view:i("view"),edit:i("edit"),add:i("add")})),k=w(!1),c=w("add"),P=w(!1),G=w(null),f=A({...o,[d]:void 0}),C=A({...r}),ne=h(()=>oe.value[c.value]+" "+(s||"")),se=h(()=>c.value!=="view"),le=e=>e[d],ie=()=>{x(C,r)},{changeCheckRow:de,checkedRowKeys:T,checkedRow:R}=Ne(),re=async()=>{z&&z(j(f)),B&&await B(),c.value="add",k.value=!0,x(f,o)},ue=async e=>{z&&z(j(f)),B&&await B();let a=J(e);!e&&R.value&&(a=R.value[0]),c.value="edit",k.value=!0,x(f,a)},ce=e=>{c.value="view",k.value=!0,x(f,J(e))},pe=()=>{var e;if(!["edit","add"].includes(c.value)){k.value=!1;return}(e=G.value)==null||e.validate(async a=>{if(a)return;const v=c.value==="add"?y:m,_=c.value==="add"?i("add"):i("edit");try{P.value=!0;const F=Q&&Q(j(f))||j(f);if(v){const we=await v(F);V.success({title:"",content:_+" "+i("sucess"),duration:1600}),Z&&Z(c.value,we),P.value=k.value=!1,b()}}catch{P.value=!1}})},N=h(()=>{var e;return(e=R.value)==null?void 0:e.map(a=>a[d])}),ve=e=>{if(e===void 0&&N.value&&N.value.length===0)return;const a=Y.warning({title:i("warn"),content:i("dureDelete"),positiveText:i("determine"),negativeText:i("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{if(N.value,e!==void 0)u&&await u(e);else{const v=N.value.map(async _=>{if(u)return await u(_)});await Promise.all(v)}a.loading=!1,u&&V.success({title:"",content:i("delete")+" "+i("sucess"),duration:1600}),b()}catch{a.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},E=w(!1),K=w(),b=async()=>{E.value=!0;try{let e={...C};n&&(e={page:(p==null?void 0:p.page)||0,pageSize:(p==null?void 0:p.pageSize)||10,...C});const a=M&&M(e);if(typeof a=="boolean"&&!a)return;a&&typeof a!="boolean"&&(e=a);const v=await Pe(l,e),{data:_,total:L}=v.data,F=O&&O([..._]);F?K.value=F||[]:K.value=_||[],n&&(p.itemCount=L||0),R.value=[],T.value=[],E.value=!1}catch{E.value=!1}},{pagination:p}=Te(b);t&&b();const me=async()=>{const e=Y.warning({title:"导出数据",content:"是否导出数据？",positiveText:i("determine"),negativeText:i("cancellation"),onPositiveClick:async()=>{e.loading=!0;try{const a={...C},v=await Re(l+"/download",a);$e(v,s),e.loading=!1,V.success({title:"",content:"导出成功",duration:1600})}catch{e.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},fe=h(()=>({edit:T.value.length!==1,del:!(T.value.length>0),download:n&&p.itemCount<=0}));return{modalVisible:k,modalAction:c,modalTitle:ne,modalLoading:P,modalShowFooter:se,handlereset:ie,handleAdd:re,handleDelete:ve,handleEdit:ue,handleView:ce,handleDownload:me,handleSave:pe,modalForm:f,modalFormRef:G,defualtQuery:C,changeCheckRow:de,loading:E,listData:K,pagination:p,listQuery:b,rowKey:le,btnDisabled:fe,checkedRowKeys:T}};export{Le as _,Ke as a,Ue as u};
