import{h as e,i as a,o as t,j as l,bm as i,w as o,t as d,bk as n,k as s,C as u,l as r,Q as v,af as c,F as p,R as h,E as f,K as g,Y as w,$ as m,aR as y,M as b,bn as k}from"./.pnpm-222492af.js";import{h as C,o as R,m as z,p as S}from"./index-a15d8d1d.js";const x={flex:"","justify-end":""},$=e({name:"BaseModel"}),B=e({...$,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(e,{emit:f}){const g=e,w=f,m=a({get:()=>g.visible,set(e){w("update:visible",e)}});return(e,a)=>{const f=p,g=h;return t(),l(g,{show:r(m),"onUpdate:show":a[2]||(a[2]=e=>v(m)?m.value=e:null),style:c({width:e.width}),preset:"card",title:e.title,size:"huge",bordered:!1},i({default:o((()=>[n(e.$slots,"default")])),_:2},[e.showFooter?{name:"footer",fn:o((()=>[d("footer",x,[n(e.$slots,"footer",{},(()=>[s(f,{onClick:a[0]||(a[0]=e=>m.value=!1)},{default:o((()=>[u("取消")])),_:1}),s(f,{loading:e.loading,"ml-20":"",type:"primary",onClick:a[1]||(a[1]=e=>w("save"))},{default:o((()=>[u("保存")])),_:1},8,["loading"])]))])])),key:"0"}:void 0]),1032,["show","style","title"])}}}),D=e({name:"TableAction"}),_=e({...D,props:{view:{type:Boolean,default:!0},edit:{type:Boolean,default:!0},del:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["handleView","handleEdit","handleDelete"],setup(e,{emit:a}){const i=e,d=a;return(e,a)=>{const n=p,s=w;return t(),l(s,{justify:"center"},{default:o((()=>[i.view?(t(),l(n,{key:0,type:"info",text:"",size:"small",onClick:a[0]||(a[0]=e=>d("handleView"))},{default:o((()=>[u(f(e.$t("view")),1)])),_:1})):g("",!0),i.edit?(t(),l(n,{key:1,disabled:e.disabled,type:"warning",text:"",size:"small",onClick:a[1]||(a[1]=e=>d("handleEdit"))},{default:o((()=>[u(f(e.$t("edit")),1)])),_:1},8,["disabled"])):g("",!0),i.del?(t(),l(n,{key:2,disabled:e.disabled,type:"error",text:"",size:"small",onClick:a[2]||(a[2]=e=>d("handleDelete"))},{default:o((()=>[u(f(e.$t("delete")),1)])),_:1},8,["disabled"])):g("",!0)])),_:1})}}}),F=({name:e,url:t,key:l="id",isPagination:i=!0,isInitQuery:o=!0,initForm:d={},initQuery:n={},doCreate:s,doDelete:u,doUpdate:r,beforeRefresh:v,afterRefresh:c,beforeSave:p,afterSave:h})=>{const{t:f}=m(),g=a((()=>({view:f("view"),edit:f("edit"),add:f("add")}))),w=b(!1),x=b(""),$=b(!1),B=b(null),D=y({...d}),_=y({...n}),F=a((()=>g.value[x.value]+" "+(e||""))),Q=a((()=>"view"!==x.value)),{changeCheckRow:j,checkedRowKeys:P,checkedRow:E}=(()=>{const e=b([]),a=b([]);return{checkedRowKeys:e,changeCheckRow:(t,l)=>{e.value=t,a.value=k(l)},checkedRow:a}})(),K=a((()=>{var e;return null==(e=E.value)?void 0:e.map((e=>e[l]))})),T=b(!1),U=b(),V=async()=>{T.value=!0;try{let e={..._};i&&(e={page:(null==A?void 0:A.page)||0,pageSize:(null==A?void 0:A.pageSize)||10,..._});const a=v&&v(e);if("boolean"==typeof a&&!a)return;a&&"boolean"!=typeof a&&(e=a);const{data:l,total:o}=await((e,a)=>C.get(e,a))(t,e),d=c&&c([...l]);U.value=d?d||[]:l||[],i&&(A.itemCount=o||0),T.value=!1}catch(e){T.value=!1}},{pagination:A}=(e=>{const{t:t}=m(),l=a((()=>({total:t("total"),tiao:t("tiao")}))),i=y({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:e})=>`${l.value.total} ${e} ${l.value.tiao}`,onUpdatePage:a=>{i.page=a,e()},onUpdatePageSize:a=>{i.page=1,i.pageSize=a,e()}});return{pagination:i}})(V);o&&V();const M=a((()=>({edit:!(1===P.value.length),del:!(P.value.length>0),download:i&&A.itemCount<=0})));return{modalVisible:w,modalAction:x,modalTitle:F,modalLoading:$,modalShowFooter:Q,handlereset:()=>{R(_,n)},handleAdd:()=>{x.value="add",w.value=!0,R(D,d)},handleDelete:e=>{if(e&&0===e.length&&K.value&&0===K.value.length)return;let a=e;e||(a=K.value);const t=S.warning({title:f("warn"),content:f("dureDelete"),positiveText:f("determine"),negativeText:f("cancellation"),onPositiveClick:async()=>{t.loading=!0;try{u&&await u(a),t.loading=!1,u&&z.success(f("delete")+" "+f("sucess")),V()}catch(e){t.loading=!1}},onNegativeClick:()=>{}})},handleEdit:e=>{let a=k(e);!e&&E.value&&(a=E.value[0]),x.value="edit",w.value=!0,R(D,a)},handleView:e=>{x.value="view",w.value=!0,R(D,k(e))},handleDownload:()=>{},handleSave:()=>{var e;["edit","add"].includes(x.value)?null==(e=B.value)||e.validate((async e=>{if(e)return;const a="add"===x.value?s:r,t="add"===x.value?f("add"):f("edit");try{$.value=!0;const e=p&&p(D)||D;a&&await a(e),h&&h(),a&&z.success(t+" "+f("sucess")),$.value=w.value=!1,V()}catch(l){$.value=!1}})):w.value=!1},modalForm:D,modalFormRef:B,defualtQuery:_,changeCheckRow:j,loading:T,listData:U,pagination:A,listQuery:V,rowKey:e=>e[l],btnDisabled:M}};export{_,B as a,F as u};
