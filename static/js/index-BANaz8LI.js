import{d as x,j as h,ae as S,m as $,al as ge,bI as g,ag as he,b3 as W,y as X,E as D,S as ye,f as ke,u as Ce,b5 as _e,af as U,L as Y,bh as q,q as A,a as w,p as I}from"./@vue-hDPt79YI.js";import{B as ee,o as be,m as Se}from"./naive-ui-B0x1dlqI.js";import{h as te,s as V,t as Z,v as $e,w as j}from"./index-BukTgyxp.js";import{u as ae}from"./vue-i18n-Dk-SIn3V.js";import{c as J}from"./lodash-es-DkZVwyoF.js";const De={flex:"","justify-end":""},ze=x({name:"BaseModel"}),Ke=x({...ze,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(l,{emit:i}){const r=l,n=i,t=h({get(){return r.visible},set(o){n("update:visible",o)}});return(o,s)=>{const y=ee,u=be;return $(),S(u,{show:Ce(t),"onUpdate:show":s[2]||(s[2]=m=>ke(t)?t.value=m:null),style:ye({width:o.width}),preset:"card",title:o.title,size:"huge",bordered:!1},ge({default:g(()=>[W(o.$slots,"default")]),_:2},[o.showFooter?{name:"footer",fn:g(()=>[he("footer",De,[W(o.$slots,"footer",{},()=>[X(y,{onClick:s[0]||(s[0]=m=>t.value=!1)},{default:g(()=>[...s[3]||(s[3]=[D("取消",-1)])]),_:1}),X(y,{loading:o.loading,"ml-20":"",type:"primary",onClick:s[1]||(s[1]=m=>n("save"))},{default:g(()=>[...s[4]||(s[4]=[D("保存",-1)])]),_:1},8,["loading"])])])]),key:"0"}:void 0]),1032,["show","style","title"])}}}),Be=x({name:"TableAction"}),Le=x({...Be,props:{optShow:{default:()=>({view:!0,edit:!0,del:!0})},disabled:{type:Boolean,default:!1},permission:{default:()=>({edit:[],del:[]})}},emits:["handleView","handleEdit","handleDelete"],setup(l,{emit:i}){const r=l,n=i;return(t,o)=>{const s=ee,y=Se,u=_e("permission");return $(),S(y,{justify:"center"},{default:g(()=>[r.optShow.view?($(),S(s,{key:0,type:"info",text:"",size:"small",onClick:o[0]||(o[0]=m=>n("handleView"))},{default:g(()=>[D(q(t.$t("view")),1)]),_:1})):U("",!0),r.optShow.edit?Y(($(),S(s,{key:1,disabled:t.disabled,type:"warning",text:"",size:"small",onClick:o[1]||(o[1]=m=>n("handleEdit"))},{default:g(()=>[D(q(t.$t("edit")),1)]),_:1},8,["disabled"])),[[u,t.permission.edit]]):U("",!0),r.optShow.del?Y(($(),S(s,{key:2,disabled:t.disabled,type:"error",text:"",size:"small",onClick:o[2]||(o[2]=m=>n("handleDelete"))},{default:g(()=>[D(q(t.$t("delete")),1)]),_:1},8,["disabled"])),[[u,t.permission.del]]):U("",!0)]),_:1})}}}),Te=(l,i)=>te.get(l,i),Pe=l=>{const{t:i}=ae(),r=h(()=>({total:i("total"),tiao:i("tiao")})),n=A({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:t})=>`${r.value.total} ${t} ${r.value.tiao}`,onUpdatePage:t=>{n.page=t,l()},onUpdatePageSize:t=>{n.page=1,n.pageSize=t,l()}});return{pagination:n}},Re=(l,i)=>te.post(l,i,{responseType:"blob"}),Ne=()=>{const l=w([]),i=w([]);return{checkedRowKeys:l,changeCheckRow:(n,t)=>{l.value=n,i.value=J(t)},checkedRow:i}},Ue=({name:l,url:i,key:r="id",isPagination:n=!0,isInitQuery:t=!0,initForm:o={},initQuery:s={},doCreate:y,doDelete:u,doUpdate:m,beforeRefresh:M,afterRefresh:O,beforeValidate:z,beforeAsyncValidate:B,beforeSave:Q,afterSave:G})=>{const{t:d}=ae(),oe=h(()=>({view:d("view"),edit:d("edit"),add:d("add")})),k=w(!1),c=w("add"),T=w(!1),H=w(null),f=A({...o,[r]:void 0}),_=A({...s}),ne=h(()=>oe.value[c.value]+" "+(l||"")),se=h(()=>c.value!=="view"),le=e=>e[r],ie=()=>{j(_,s)},{changeCheckRow:de,checkedRowKeys:P,checkedRow:R}=Ne(),re=async()=>{z&&z(I(f)),B&&await B(),c.value="add",k.value=!0,j(f,o)},ue=async e=>{z&&z(I(f)),B&&await B();let a=J(e);!e&&R.value&&(a=R.value[0]),c.value="edit",k.value=!0,j(f,a)},ce=e=>{c.value="view",k.value=!0,j(f,J(e))},pe=()=>{var e;if(!["edit","add"].includes(c.value)){k.value=!1;return}(e=H.value)==null||e.validate(async a=>{if(a)return;const v=c.value==="add"?y:m,C=c.value==="add"?d("add"):d("edit");try{T.value=!0;const F=Q&&Q(I(f))||I(f);if(v){const we=await v(F);V.success({title:"",content:C+" "+d("sucess"),duration:1600}),G&&G(c.value,we),T.value=k.value=!1,b()}}catch{T.value=!1}})},N=h(()=>{var e;return(e=R.value)==null?void 0:e.map(a=>a[r])}),ve=e=>{if(e===void 0&&N.value&&N.value.length===0)return;const a=Z.warning({title:d("warn"),content:d("dureDelete"),positiveText:d("determine"),negativeText:d("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{if(N.value,e!==void 0)u&&await u(e);else{const v=N.value.map(async C=>{if(u)return await u(C)});await Promise.all(v)}a.loading=!1,u&&V.success({title:"",content:d("delete")+" "+d("sucess"),duration:1600}),b()}catch{a.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},E=w(!1),K=w(),b=async()=>{E.value=!0;try{let e={..._};n&&(e={page:(p==null?void 0:p.page)||0,pageSize:(p==null?void 0:p.pageSize)||10,..._});const a=M&&M(e);if(typeof a=="boolean"&&!a)return;a&&typeof a!="boolean"&&(e=a);const v=await Te(i,e),{data:C,total:L}=v.data,F=O&&O([...C]);F?K.value=F||[]:K.value=C||[],n&&(p.itemCount=L||0),R.value=[],P.value=[],E.value=!1}catch{E.value=!1}},{pagination:p}=Pe(b);t&&b();const me=async()=>{const e=Z.warning({title:"导出数据",content:"是否导出数据？",positiveText:d("determine"),negativeText:d("cancellation"),onPositiveClick:async()=>{e.loading=!0;try{const a={..._},v=await Re(i+"/download",a);$e(v,l),e.loading=!1,V.success({title:"",content:"导出成功",duration:1600})}catch{e.loading=!1}},onNegativeClick:()=>{console.log("取消")}})},fe=h(()=>({edit:P.value.length!==1,del:!(P.value.length>0),download:n&&p.itemCount<=0}));return{modalVisible:k,modalAction:c,modalTitle:ne,modalLoading:T,modalShowFooter:se,handlereset:ie,handleAdd:re,handleDelete:ve,handleEdit:ue,handleView:ce,handleDownload:me,handleSave:pe,modalForm:f,modalFormRef:H,defualtQuery:_,changeCheckRow:de,loading:E,listData:K,pagination:p,listQuery:b,rowKey:le,btnDisabled:fe,checkedRowKeys:P}};export{Le as _,Ke as a,Ue as u};
