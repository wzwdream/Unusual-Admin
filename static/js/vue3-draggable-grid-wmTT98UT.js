import{c as he}from"./copy-to-clipboard-CoXQxBGa.js";import{r as we}from"./vue-B-9rG3Ki.js";var R={exports:{}};(function(xe,Z){(function(M,e){e(Z,we)})(he,function(M,e){const W=Symbol(),ee=(t,a,r)=>(r-(t-1)*a)/t,P=(t,a,r)=>{let l=0,i=0;for(const{y:o,h:n}of r)o+n>l+i&&(l=o,i=n);return(l+i-2)*a+(l+i-1)*t+t+a},j=(t,a,r=0)=>t<=0?1:r&&t+a>=r+1?r+1-a:t,k=(t,a)=>{const r=t.findIndex(i=>i.id===a),l=t[r];return{index:r,data:l}},te=(t,a,r,l,i,o)=>{if(!t)return;const n=t.getContext("2d");if(n){n.clearRect(0,0,t.width,t.height),t.width=r-10,t.height=a,n.fillStyle="#000",n.lineWidth=.2,n.setLineDash([20,5]);for(let d=i+Number(o)/2;d<a;d=d+i+Number(o))n.beginPath(),n.moveTo(0,d),n.lineTo(r,d),n.stroke();for(let d=l+Number(o)/2;d<r;d=d+l+Number(o))n.beginPath(),n.moveTo(d,0),n.lineTo(d,a),n.stroke()}},B=(t,a=new WeakMap)=>{if(t===null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t.source);if(a.has(t))return a.get(t);const r=Array.isArray(t)?[]:Object.create(null);a.set(t,r);for(const l in t)r[l]=B(t[l],a);return r},A=({x:t,y:a,w:r,h:l},{x:i,y:o,w:n,h:d})=>t+r>i&&t<i+n&&a+l>o&&a<o+d,ae=t=>t.filter(a=>!!a.static),T=(t,a)=>t.filter(r=>r.id!==a.id).some(r=>A(a,r)),O=(t,a,r)=>{const{index:l,data:i}=k(t,a),{w:o,static:n}=i;if(n)return t;let d=i.x,u=i.y,m="left",N="";const $=()=>T(t,{...i,x:d,y:u});for(;$();)if(m==="left"&&(d>1?d--:m="right"),m==="right"&&(d+o<=r?d++:(N===""&&(N="up"),m="left")),N==="up"&&(u>1?(u--,N=""):N="down"),N==="down"){if(d+o<=r)continue;u++,m="left"}const L={...i,x:d,y:u};return[...t.slice(0,l),L,...t.slice(l+1)]},re=(t,a)=>t.filter(r=>r.id!==a.id&&A(a,r)).map(r=>r.id),F=(t,a,r)=>{let l=B(t),i=a.x,o=a.y;const n=ae(t);if(T(n,a)){const{x:u,y:m}=J(n,a,r);i=u,o=m}a={...a,x:i,y:o};const{index:d}=k(l,a.id);if(l[d]=a,T(l,a)){const u=re(l,a);for(const m of u)l=O(l,m,r)}return{data:l,x:i,y:o}},X=(t,a)=>{let r=B(t);for(let l=0;l<r.length;l++){const i=r[l];i.static||(i.x<0&&(i.x=1),i.x+i.w>a+1&&(i.x=1),i.w>a&&(i.w=a)),r=F(r,i,a).data}return r},J=(t,a,r)=>{const l=[...t,{...a}],i=O(l,a.id,r),{data:o}=k(i,a.id);return{data:i,x:o.x,y:o.y}},le=t=>{const a=e.ref(Number(t.col)),r=e.ref(Number(t.rowH)),l=e.ref(Number(t.gutter)),i=e.ref(t.isCollision||!0),o=e.ref(B(X(t.data,a.value))),n=e.ref(!1),d=e.ref("");let u=e.reactive({x:0,y:0,h:0,w:0});const m=e.computed(()=>{const{index:w,data:f}=k(o.value,d.value);return{index:w,data:f}}),N=w=>{d.value=w;const{x:f,y:x,h:g,w:v}=m.value.data;u.x=f,u.y=x,u.h=g,u.w=v,n.value=!0},$=(w,f,x,g)=>{const{x:v,y:I,h:E,w:D}=m.value.data,c=Math.round(w/(x+l.value)),s=Math.round(f/(r.value+l.value));if(g==="drag"){const y=v+c,z=I+s;u.x=j(y,D,a.value),u.y=j(z,E)}g==="resize"&&(u.w=D+c<=0?1:v+c>a.value?a.value-v+D:D+c,u.h=E+s<=0?1:E+s);let p={...u,id:d.value};const{data:b,x:S,y:_}=i.value?F(o.value,p,a.value):J(o.value.filter(y=>y.id!==d.value),p,a.value);return p={...p,x:S,y:_},u.x=S,u.y=_,b.forEach(y=>{if(y.id!==d.value){const{index:z}=k(o.value,y.id);o.value.splice(z,1,y)}}),{newData:b,newItem:p}},L=()=>{const{x:w,y:f,h:x,w:g}=u,{index:v,data:I}=m.value,E={...I,x:w,y:f,h:x,w:g};o.value.splice(v,1,E),n.value=!1},h=w=>{d.value=w;const{index:f}=m.value;o.value.splice(f,1)},C=e.computed(()=>({xStart:u.x,yStart:u.y,xEnd:u.x+u.w,yEnd:u.y+u.h}));return{layoutdata:o,col:a,rowH:r,gutter:l,draggableStart:N,draggableHandle:$,draggableEnd:L,drageItem:u,isDraging:n,dragingstyle:C,removes:h,propsId:d,dragingData:m,isCollision:i}},ie=()=>{const t=e.ref(0),a=e.ref(0),r=e.computed(()=>`${a.value}px`),l=e.reactive({gridTemplateColumns:"repeat(0, minmax(50px, 1fr))",gridAutoRows:"0px",gap:"0px",height:r});return{colWidth:t,layoutHeight:a,layoutStyle:l,updateStyle:(i,o,n)=>{l.gridTemplateColumns=`repeat(${i}, ${t.value}px)`,l.gridAutoRows=`${o}px`,l.gap=`${n}px`}}},oe={class:"grid"},de={class:"dragingItem"},ne=e.defineComponent({__name:"GridLayout",props:{data:{default:()=>[]},width:{},height:{},col:{default:12},rowH:{default:50},gutter:{default:10},drage:{type:Boolean,default:!0},resize:{type:Boolean,default:!0},remove:{type:Boolean,default:!0},isDrawGridLines:{type:Boolean,default:!0},isCollision:{type:Boolean,default:!0}},emits:["update:data","draggableStart","draggableHandle","draggableEnd","remove"],setup(t,{emit:a}){e.useCssVars(H=>({"0d474d30":e.unref(D).gridTemplateColumns,"2338659b":e.unref(D).gridAutoRows,"2bd72429":e.unref(D).gap,"79b6d218":e.unref(D).height,"7cae44e4":e.unref(w).yStart,"8017f622":e.unref(w).xStart,"0bebfd07":e.unref(w).yEnd,"0beb88a8":e.unref(w).xEnd}));const r=t,l=e.ref(),i=e.computed(()=>r.drage),o=e.computed(()=>r.resize),n=e.computed(()=>r.remove),d=e.computed(()=>r.isDrawGridLines),{draggableStart:u,draggableHandle:m,draggableEnd:N,isDraging:$,isCollision:L,removes:h,propsId:C,dragingstyle:w,layoutdata:f,col:x,rowH:g,gutter:v}=le(r),{layoutHeight:I,colWidth:E,layoutStyle:D,updateStyle:c}=ie(),s=e.ref(null),p=()=>{s.value&&(E.value=ee(x.value,v.value,s.value.clientWidth))},b=()=>{l.value&&s.value&&r.isDrawGridLines&&te(l.value,I.value,s.value.clientWidth,E.value,g.value,v.value)},S=()=>{s.value&&(I.value=P(g.value,v.value,f.value))};e.watch([x,g,v,f],()=>{p(),$.value||S(),b()}),e.onMounted(()=>{p(),S(),b(),window.onresize=()=>{p(),b()}}),e.watchEffect(()=>{$.value||(f.value=B(X(r.data,Number(r.col))),JSON.stringify(f.value)!==JSON.stringify(r.data)&&y()),g.value=Number(r.rowH),x.value=Number(r.col),v.value=Number(r.gutter),L.value=r.isCollision,c(x.value,g.value,v.value)});const _=a,y=()=>{_("update:data",f.value)},z=H=>{u(H),_("draggableStart",H)},G=(H,U,fe)=>{const{newData:me,newItem:pe}=m(H,U,E.value,fe);I.value=P(g.value,v.value,me),_("draggableHandle",C.value,pe)},V=()=>{N(),y(),_("draggableEnd",f.value)},ge=H=>{h(H),y(),_("remove",H)};return e.provide(W,{layoutdata:f,rowH:g,col:x,gutter:v,colWidth:E,drage:i,resize:o,remove:n,draggableStart:z,draggableHandle:G,draggableEnd:V,removes:ge}),(H,U)=>(e.openBlock(),e.createElementBlock("div",oe,[e.withDirectives(e.createElementVNode("canvas",{ref_key:"canvas",ref:l,class:"canvas"},null,512),[[e.vShow,d.value]]),e.createElementVNode("div",{class:"grid-layout",ref_key:"gridLayoutRef",ref:s},[e.renderSlot(H.$slots,"default",{},void 0,!0),e.withDirectives(e.createElementVNode("div",de,null,512),[[e.vShow,e.unref($)]])],512)]))}}),Y=(t,a)=>{const r=t.__vccOpts||t;for(const[l,i]of a)r[l]=i;return r},q=Y(ne,[["__scopeId","data-v-2298e8ec"]]),K=t=>(e.pushScopeId("data-v-3f0d6c87"),t=t(),e.popScopeId(),t),ue=K(()=>e.createElementVNode("div",{class:"grid-item-resize"},null,-1)),se=["onPointerdown"],ve=K(()=>e.createElementVNode("div",{class:"grid-item-remove"},"X",-1)),Q=Y(e.defineComponent({__name:"GridItem",props:{id:{default:""},draggableFrom:{default:""}},setup(t){e.useCssVars(c=>({"142aac51":h.value.yStart,"1275d3b2":h.value.xStart,"99eebeec":h.value.yEnd,"99efa7aa":h.value.xEnd,a4010844:h.value.width,"0fbdf3e2":h.value.height,"33b83680":v.width,"297f9fad":v.height,"4c9cf1b4":v.transform}));const a=t,{layoutdata:r,rowH:l,gutter:i,colWidth:o,drage:n,resize:d,remove:u,draggableStart:m,draggableHandle:N,draggableEnd:$,removes:L}=e.inject(W),h=e.computed(()=>{const{data:c}=k(r.value,a.id),{x:s,y:p,w:b,h:S,static:_}=c,y=s+b,z=p+S,G=`${(b-1)*i.value+b*o.value}px`,V=`${(S-1)*i.value+S*l.value}px`;return{xStart:s,yStart:p,xEnd:y,yEnd:z,width:G,height:V,data:c,static:!!_}}),C=e.ref(null),w=e.ref(0),f=e.ref(0),x=e.ref(!1),g=e.ref();e.onMounted(()=>{var c;if(!(h.value.static||!n.value))if((a.draggableFrom??"")==="")(c=C.value)==null||c.addEventListener("pointerdown",s=>{I(s,"drag")});else{const s=document.getElementById(a.draggableFrom);s&&(s.style.cursor="move",s.addEventListener("pointerdown",p=>{I(p,"drag")}))}});const v=e.reactive({width:"0px",height:"0px",transform:"translate3d(0, 0, 0)"}),I=(c,s)=>{h.value.data.static||!n||!s||(g.value=s,w.value=c.clientX,f.value=c.clientY,window.addEventListener("pointermove",E),window.addEventListener("pointerup",D),x.value=!0,m(a.id))},E=c=>{const{clientX:s,clientY:p}=c,b=s-w.value,S=p-f.value;if(g.value==="drag"&&(v.transform=`translate3d(${b}px, ${S}px, 0)`),g.value==="resize"&&r){const{width:_,height:y}=h.value,z=Math.max(parseInt(_)+b,o.value),G=Math.max(parseInt(y)+S,l.value);v.width=`${z}px`,v.height=`${G}px`}N(b,S,g.value)},D=()=>{if(g.value==="drag"&&(v.transform="translate3d(0, 0, 0)"),g.value==="resize"&&r){const{width:c,height:s}=h.value;v.width=`${parseInt(c)}px`,v.height=`${parseInt(s)}px`}window.removeEventListener("pointermove",E),window.removeEventListener("pointerup",D),$(),x.value=!1};return(c,s)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["grid-item-box",{"grid-draging":x.value&&g.value==="drag"}]),ref_key:"gridItemRef",ref:C},[e.createElementVNode("div",{class:e.normalizeClass({"grid-item":!0,"static-item":h.value.static||a.draggableFrom,"grid-resizing":x.value&&g.value==="resize"})},[e.renderSlot(c.$slots,"default",{},void 0,!0),e.withDirectives(e.createElementVNode("div",{onPointerdown:s[0]||(s[0]=e.withModifiers(p=>I(p,"resize"),["stop"]))},[e.renderSlot(c.$slots,"resize",{},()=>[ue],!0)],544),[[e.vShow,e.unref(d)&&!h.value.static]]),e.withDirectives(e.createElementVNode("div",{onPointerdown:e.withModifiers(I,["stop"]),onClick:s[1]||(s[1]=e.withModifiers(p=>e.unref(L)(a.id),["stop"]))},[e.renderSlot(c.$slots,"remove",{},()=>[ve],!0)],40,se),[[e.vShow,e.unref(u)&&!h.value.static]])],2)],2))}}),[["__scopeId","data-v-3f0d6c87"]]),ce={install:t=>{t.component("grid-layout",q),t.component("grid-item",Q)}};M.GridItem=Q,M.GridLayout=q,M.default=ce,Object.defineProperties(M,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})})(R,R.exports);var Ee=R.exports;export{Ee as v};
