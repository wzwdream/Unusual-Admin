import{c as e}from"./@babel-DJq229zv.js";import{r as t}from"./vue-KLVFeDWS.js";var a={exports:{}};!function(e,t){const a=Symbol(),r=(e,t,a)=>(a-(e-1)*t)/e,l=(e,t,a)=>{let r=0,l=0;for(const{y:i,h:o}of a)i+o>r+l&&(r=i,l=o);return(r+l-2)*t+(r+l-1)*e+e+t},i=(e,t,a=0)=>e<=0?1:a&&e+t>=a+1?a+1-t:e,o=(e,t)=>{const a=e.findIndex((e=>e.id===t));return{index:a,data:e[a]}},n=(e,t,a,r,l,i)=>{if(!e)return;const o=e.getContext("2d");if(o){o.clearRect(0,0,e.width,e.height),e.width=a-10,e.height=t,o.fillStyle="#000",o.lineWidth=.2,o.setLineDash([20,5]);for(let e=l+Number(i)/2;e<t;e=e+l+Number(i))o.beginPath(),o.moveTo(0,e),o.lineTo(a,e),o.stroke();for(let e=r+Number(i)/2;e<a;e=e+r+Number(i))o.beginPath(),o.moveTo(e,0),o.lineTo(e,t),o.stroke()}},d=(e,t=new WeakMap)=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source);if(t.has(e))return t.get(e);const a=Array.isArray(e)?[]:Object.create(null);t.set(e,a);for(const r in e)a[r]=d(e[r],t);return a},u=({x:e,y:t,w:a,h:r},{x:l,y:i,w:o,h:n})=>e+a>l&&e<l+o&&t+r>i&&t<i+n,s=e=>e.filter((e=>!!e.static)),v=(e,t)=>e.filter((e=>e.id!==t.id)).some((e=>u(t,e))),c=(e,t,a)=>{const{index:r,data:l}=o(e,t),{w:i,static:n}=l;if(n)return e;let d=l.x,u=l.y,s="left",c="";const g=()=>v(e,{...l,x:d,y:u});for(;g();)if("left"===s&&(d>1?d--:s="right"),"right"===s&&(d+i<=a?d++:(""===c&&(c="up"),s="left")),"up"===c&&(u>1?(u--,c=""):c="down"),"down"===c){if(d+i<=a)continue;u++,s="left"}const f={...l,x:d,y:u};return[...e.slice(0,r),f,...e.slice(r+1)]},g=(e,t)=>e.filter((e=>e.id!==t.id&&u(t,e))).map((e=>e.id)),f=(e,t,a)=>{let r=d(e),l=t.x,i=t.y;const n=s(e);if(v(n,t)){const{x:e,y:r}=p(n,t,a);l=e,i=r}t={...t,x:l,y:i};const{index:u}=o(r,t.id);if(r[u]=t,v(r,t)){const e=g(r,t);for(const t of e)r=c(r,t,a)}return{data:r,x:l,y:i}},m=(e,t)=>{let a=d(e);for(let r=0;r<a.length;r++){const e=a[r];e.static||(e.x<0&&(e.x=1),e.x+e.w>t+1&&(e.x=1),e.w>t&&(e.w=t)),a=f(a,e,t).data}return a},p=(e,t,a)=>{const r=[...e,{...t}],l=c(r,t.id,a),{data:i}=o(l,t.id);return{data:l,x:i.x,y:i.y}},h=e=>{const a=t.ref(Number(e.col)),r=t.ref(Number(e.rowH)),l=t.ref(Number(e.gutter)),n=t.ref(e.isCollision||!0),u=t.ref(d(m(e.data,a.value))),s=t.ref(!1),v=t.ref("");let c=t.reactive({x:0,y:0,h:0,w:0});const g=t.computed((()=>{const{index:e,data:t}=o(u.value,v.value);return{index:e,data:t}})),h=e=>{v.value=e;const{x:t,y:a,h:r,w:l}=g.value.data;c.x=t,c.y=a,c.h=r,c.w=l,s.value=!0},w=(e,t,d,s)=>{const{x:m,y:h,h:w,w:x}=g.value.data,y=Math.round(e/(d+l.value)),b=Math.round(t/(r.value+l.value));if("drag"===s){const e=m+y,t=h+b;c.x=i(e,x,a.value),c.y=i(t,w)}"resize"===s&&(c.w=x+y<=0?1:m+y>a.value?a.value-m+x:x+y,c.h=w+b<=0?1:w+b);let E={...c,id:v.value};const{data:S,x:N,y:I}=n.value?f(u.value,E,a.value):p(u.value.filter((e=>e.id!==v.value)),E,a.value);return E={...E,x:N,y:I},c.x=N,c.y=I,S.forEach((e=>{if(e.id!==v.value){const{index:t}=o(u.value,e.id);u.value.splice(t,1,e)}})),{newData:S,newItem:E}},x=()=>{const{x:e,y:t,h:a,w:r}=c,{index:l,data:i}=g.value,o={...i,x:e,y:t,h:a,w:r};u.value.splice(l,1,o),s.value=!1},y=e=>{v.value=e;const{index:t}=g.value;u.value.splice(t,1)},b=t.computed((()=>({xStart:c.x,yStart:c.y,xEnd:c.x+c.w,yEnd:c.y+c.h})));return{layoutdata:u,col:a,rowH:r,gutter:l,draggableStart:h,draggableHandle:w,draggableEnd:x,drageItem:c,isDraging:s,dragingstyle:b,removes:y,propsId:v,dragingData:g,isCollision:n}},w=()=>{const e=t.ref(0),a=t.ref(0),r=t.computed((()=>`${a.value}px`)),l=t.reactive({gridTemplateColumns:"repeat(0, minmax(50px, 1fr))",gridAutoRows:"0px",gap:"0px",height:r});return{colWidth:e,layoutHeight:a,layoutStyle:l,updateStyle:(t,a,r)=>{l.gridTemplateColumns=`repeat(${t}, ${e.value}px)`,l.gridAutoRows=`${a}px`,l.gap=`${r}px`}}},x={class:"grid"},y={class:"dragingItem"},b=t.defineComponent({__name:"GridLayout",props:{data:{default:()=>[]},width:{},height:{},col:{default:12},rowH:{default:50},gutter:{default:10},drage:{type:Boolean,default:!0},resize:{type:Boolean,default:!0},remove:{type:Boolean,default:!0},isDrawGridLines:{type:Boolean,default:!0},isCollision:{type:Boolean,default:!0}},emits:["update:data","draggableStart","draggableHandle","draggableEnd","remove"],setup(e,{emit:i}){t.useCssVars((e=>({"0d474d30":t.unref(M).gridTemplateColumns,"2338659b":t.unref(M).gridAutoRows,"2bd72429":t.unref(M).gap,"79b6d218":t.unref(M).height,"7cae44e4":t.unref(C).yStart,"8017f622":t.unref(C).xStart,"0bebfd07":t.unref(C).yEnd,"0beb88a8":t.unref(C).xEnd})));const o=e,u=t.ref(),s=t.computed((()=>o.drage)),v=t.computed((()=>o.resize)),c=t.computed((()=>o.remove)),g=t.computed((()=>o.isDrawGridLines)),{draggableStart:f,draggableHandle:p,draggableEnd:b,isDraging:E,isCollision:S,removes:N,propsId:I,dragingstyle:C,layoutdata:z,col:D,rowH:H,gutter:$}=h(o),{layoutHeight:_,colWidth:L,layoutStyle:M,updateStyle:k}=w(),B=t.ref(null),T=()=>{B.value&&(L.value=r(D.value,$.value,B.value.clientWidth))},V=()=>{u.value&&B.value&&o.isDrawGridLines&&n(u.value,_.value,B.value.clientWidth,L.value,H.value,$.value)},R=()=>{B.value&&(_.value=l(H.value,$.value,z.value))};t.watch([D,H,$,z],(()=>{T(),E.value||R(),V()})),t.onMounted((()=>{T(),R(),V(),window.onresize=()=>{T(),V()}})),t.watchEffect((()=>{E.value||(z.value=d(m(o.data,Number(o.col))),JSON.stringify(z.value)!==JSON.stringify(o.data)&&G()),H.value=Number(o.rowH),D.value=Number(o.col),$.value=Number(o.gutter),S.value=o.isCollision,k(D.value,H.value,$.value)}));const W=i,G=()=>{W("update:data",z.value)},j=e=>{f(e),W("draggableStart",e)},P=(e,t,a)=>{const{newData:r,newItem:i}=p(e,t,L.value,a);_.value=l(H.value,$.value,r),W("draggableHandle",I.value,i)},A=()=>{b(),G(),W("draggableEnd",z.value)},O=e=>{N(e),G(),W("remove",e)};return t.provide(a,{layoutdata:z,rowH:H,col:D,gutter:$,colWidth:L,drage:s,resize:v,remove:c,draggableStart:j,draggableHandle:P,draggableEnd:A,removes:O}),(e,a)=>(t.openBlock(),t.createElementBlock("div",x,[t.withDirectives(t.createElementVNode("canvas",{ref_key:"canvas",ref:u,class:"canvas"},null,512),[[t.vShow,g.value]]),t.createElementVNode("div",{class:"grid-layout",ref_key:"gridLayoutRef",ref:B},[t.renderSlot(e.$slots,"default",{},void 0,!0),t.withDirectives(t.createElementVNode("div",y,null,512),[[t.vShow,t.unref(E)]])],512)]))}}),E=(e,t)=>{const a=e.__vccOpts||e;for(const[r,l]of t)a[r]=l;return a},S=E(b,[["__scopeId","data-v-2298e8ec"]]),N=e=>(t.pushScopeId("data-v-3f0d6c87"),e=e(),t.popScopeId(),e),I=N((()=>t.createElementVNode("div",{class:"grid-item-resize"},null,-1))),C=["onPointerdown"],z=N((()=>t.createElementVNode("div",{class:"grid-item-remove"},"X",-1))),D=E(t.defineComponent({__name:"GridItem",props:{id:{default:""},draggableFrom:{default:""}},setup(e){t.useCssVars((e=>({"142aac51":p.value.yStart,"1275d3b2":p.value.xStart,"99eebeec":p.value.yEnd,"99efa7aa":p.value.xEnd,a4010844:p.value.width,"0fbdf3e2":p.value.height,"33b83680":E.width,"297f9fad":E.height,"4c9cf1b4":E.transform})));const r=e,{layoutdata:l,rowH:i,gutter:n,colWidth:d,drage:u,resize:s,remove:v,draggableStart:c,draggableHandle:g,draggableEnd:f,removes:m}=t.inject(a),p=t.computed((()=>{const{data:e}=o(l.value,r.id),{x:t,y:a,w:u,h:s,static:v}=e;return{xStart:t,yStart:a,xEnd:t+u,yEnd:a+s,width:(u-1)*n.value+u*d.value+"px",height:(s-1)*n.value+s*i.value+"px",data:e,static:!!v}})),h=t.ref(null),w=t.ref(0),x=t.ref(0),y=t.ref(!1),b=t.ref();t.onMounted((()=>{var e;if(!p.value.static&&u.value)if(""===(r.draggableFrom??""))null==(e=h.value)||e.addEventListener("pointerdown",(e=>{S(e,"drag")}));else{const e=document.getElementById(r.draggableFrom);e&&(e.style.cursor="move",e.addEventListener("pointerdown",(e=>{S(e,"drag")})))}}));const E=t.reactive({width:"0px",height:"0px",transform:"translate3d(0, 0, 0)"}),S=(e,t)=>{p.value.data.static||!u||!t||(b.value=t,w.value=e.clientX,x.value=e.clientY,window.addEventListener("pointermove",N),window.addEventListener("pointerup",D),y.value=!0,c(r.id))},N=e=>{const{clientX:t,clientY:a}=e,r=t-w.value,o=a-x.value;if("drag"===b.value&&(E.transform=`translate3d(${r}px, ${o}px, 0)`),"resize"===b.value&&l){const{width:e,height:t}=p.value,a=Math.max(parseInt(e)+r,d.value),l=Math.max(parseInt(t)+o,i.value);E.width=`${a}px`,E.height=`${l}px`}g(r,o,b.value)},D=()=>{if("drag"===b.value&&(E.transform="translate3d(0, 0, 0)"),"resize"===b.value&&l){const{width:e,height:t}=p.value;E.width=`${parseInt(e)}px`,E.height=`${parseInt(t)}px`}window.removeEventListener("pointermove",N),window.removeEventListener("pointerup",D),f(),y.value=!1};return(e,a)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["grid-item-box",{"grid-draging":y.value&&"drag"===b.value}]),ref_key:"gridItemRef",ref:h},[t.createElementVNode("div",{class:t.normalizeClass({"grid-item":!0,"static-item":p.value.static||r.draggableFrom,"grid-resizing":y.value&&"resize"===b.value})},[t.renderSlot(e.$slots,"default",{},void 0,!0),t.withDirectives(t.createElementVNode("div",{onPointerdown:a[0]||(a[0]=t.withModifiers((e=>S(e,"resize")),["stop"]))},[t.renderSlot(e.$slots,"resize",{},(()=>[I]),!0)],544),[[t.vShow,t.unref(s)&&!p.value.static]]),t.withDirectives(t.createElementVNode("div",{onPointerdown:t.withModifiers(S,["stop"]),onClick:a[1]||(a[1]=t.withModifiers((e=>t.unref(m)(r.id)),["stop"]))},[t.renderSlot(e.$slots,"remove",{},(()=>[z]),!0)],40,C),[[t.vShow,t.unref(v)&&!p.value.static]])],2)],2))}}),[["__scopeId","data-v-3f0d6c87"]]),H={install:e=>{e.component("grid-layout",S),e.component("grid-item",D)}};e.GridItem=D,e.GridLayout=S,e.default=H,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(a.exports,t);var r=a.exports;export{r as v};
