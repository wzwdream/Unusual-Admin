import{h as e,i as a,o as t,j as l,bm as i,w as o,t as n,bk as d,k as s,C as u,l as r,Q as c,af as v,F as p,R as h,E as f,K as g,Y as w,$ as y,aR as m,M as b,bn as k}from"./.pnpm-222492af.js";import{h as C,o as x,m as R,p as z,q as S}from"./index-e72a38f8.js";const $={flex:"","justify-end":""},B=e({name:"BaseModel"}),D=e({...B,props:{width:{default:"600px"},title:{default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(e,{emit:f}){const g=e,w=f,y=a({get:()=>g.visible,set(e){w("update:visible",e)}});return(e,a)=>{const f=p,g=h;return t(),l(g,{show:r(y),"onUpdate:show":a[2]||(a[2]=e=>c(y)?y.value=e:null),style:v({width:e.width}),preset:"card",title:e.title,size:"huge",bordered:!1},i({default:o((()=>[d(e.$slots,"default")])),_:2},[e.showFooter?{name:"footer",fn:o((()=>[n("footer",$,[d(e.$slots,"footer",{},(()=>[s(f,{onClick:a[0]||(a[0]=e=>y.value=!1)},{default:o((()=>[u("取消")])),_:1}),s(f,{loading:e.loading,"ml-20":"",type:"primary",onClick:a[1]||(a[1]=e=>w("save"))},{default:o((()=>[u("保存")])),_:1},8,["loading"])]))])])),key:"0"}:void 0]),1032,["show","style","title"])}}}),_=e({name:"TableAction"}),F=e({..._,props:{view:{type:Boolean,default:!0},edit:{type:Boolean,default:!0},del:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["handleView","handleEdit","handleDelete"],setup(e,{emit:a}){const i=e,n=a;return(e,a)=>{const d=p,s=w;return t(),l(s,{justify:"center"},{default:o((()=>[i.view?(t(),l(d,{key:0,type:"info",text:"",size:"small",onClick:a[0]||(a[0]=e=>n("handleView"))},{default:o((()=>[u(f(e.$t("view")),1)])),_:1})):g("",!0),i.edit?(t(),l(d,{key:1,disabled:e.disabled,type:"warning",text:"",size:"small",onClick:a[1]||(a[1]=e=>n("handleEdit"))},{default:o((()=>[u(f(e.$t("edit")),1)])),_:1},8,["disabled"])):g("",!0),i.del?(t(),l(d,{key:2,disabled:e.disabled,type:"error",text:"",size:"small",onClick:a[2]||(a[2]=e=>n("handleDelete"))},{default:o((()=>[u(f(e.$t("delete")),1)])),_:1},8,["disabled"])):g("",!0)])),_:1})}}}),P=({name:e,url:t,key:l="id",isPagination:i=!0,isInitQuery:o=!0,initForm:n={},initQuery:d={},doCreate:s,doDelete:u,doUpdate:r,beforeRefresh:c,afterRefresh:v,beforeSave:p,afterSave:h})=>{const{t:f}=y(),g=a((()=>({view:f("view"),edit:f("edit"),add:f("add")}))),w=b(!1),$=b(""),B=b(!1),D=b(null),_=m({...n}),F=m({...d}),P=a((()=>g.value[$.value]+" "+(e||""))),T=a((()=>"view"!==$.value)),{changeCheckRow:Q,checkedRowKeys:j,checkedRow:E}=(()=>{const e=b([]),a=b([]);return{checkedRowKeys:e,changeCheckRow:(t,l)=>{e.value=t,a.value=k(l)},checkedRow:a}})(),K=a((()=>{var e;return null==(e=E.value)?void 0:e.map((e=>e[l]))})),U=b(!1),V=b(),A=async()=>{U.value=!0;try{let e={...F};i&&(e={page:(null==M?void 0:M.page)||0,pageSize:(null==M?void 0:M.pageSize)||10,...F});const a=c&&c(e);if("boolean"==typeof a&&!a)return;a&&"boolean"!=typeof a&&(e=a);const l=await((e,a)=>C.get(e,a))(t,e),{data:o,total:n}=l.data,d=v&&v([...o]);V.value=d?d||[]:o||[],i&&(M.itemCount=n||0),U.value=!1}catch(e){U.value=!1}},{pagination:M}=(e=>{const{t:t}=y(),l=a((()=>({total:t("total"),tiao:t("tiao")}))),i=m({page:1,pageSize:10,itemCount:0,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:e})=>`${l.value.total} ${e} ${l.value.tiao}`,onUpdatePage:a=>{i.page=a,e()},onUpdatePageSize:a=>{i.page=1,i.pageSize=a,e()}});return{pagination:i}})(A);o&&A();const N=a((()=>({edit:!(1===j.value.length),del:!(j.value.length>0),download:i&&M.itemCount<=0})));return{modalVisible:w,modalAction:$,modalTitle:P,modalLoading:B,modalShowFooter:T,handlereset:()=>{x(F,d)},handleAdd:()=>{$.value="add",w.value=!0,x(_,n)},handleDelete:e=>{if(void 0===e&&K.value&&0===K.value.length)return;const a=z.warning({title:f("warn"),content:f("dureDelete"),positiveText:f("determine"),negativeText:f("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{if(K.value,void 0!==e)u&&await u(e);else{const e=K.value.map((async e=>{if(u)return await u(e)}));await Promise.all(e)}a.loading=!1,u&&R.success(f("delete")+" "+f("sucess")),A()}catch(t){a.loading=!1}},onNegativeClick:()=>{}})},handleEdit:e=>{let a=k(e);!e&&E.value&&(a=E.value[0]),$.value="edit",w.value=!0,x(_,a)},handleView:e=>{$.value="view",w.value=!0,x(_,k(e))},handleDownload:async()=>{const a=z.warning({title:"导出数据",content:"是否导出数据？",positiveText:f("determine"),negativeText:f("cancellation"),onPositiveClick:async()=>{a.loading=!0;try{const l={...F},i=await((e,a)=>C.post(e,a,{responseType:"blob"}))(t+"/download",l);S(i,e),a.loading=!1,R.success("导出成功")}catch(l){a.loading=!1}},onNegativeClick:()=>{}})},handleSave:()=>{var e;["edit","add"].includes($.value)?null==(e=D.value)||e.validate((async e=>{if(e)return;const a="add"===$.value?s:r,t="add"===$.value?f("add"):f("edit");try{B.value=!0;const e=p&&p(_)||_;a&&await a(e),h&&h(),a&&R.success(t+" "+f("sucess")),B.value=w.value=!1,A()}catch(l){B.value=!1}})):w.value=!1},modalForm:_,modalFormRef:D,defualtQuery:F,changeCheckRow:Q,loading:U,listData:V,pagination:M,listQuery:A,rowKey:e=>e[l],btnDisabled:N}};export{F as _,D as a,P as u};
